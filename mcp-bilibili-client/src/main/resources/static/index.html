<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å“”å“©å“”å“©MCPå®¢æˆ·ç«¯æ§åˆ¶å°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            padding-top: 2rem;
            padding-bottom: 2rem;
        }
        .card {
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .card-header {
            background: rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
        }
        .btn-primary:hover {
            background: linear-gradient(45deg, #5a6fd8, #6a4190);
            transform: translateY(-2px);
        }
        .result-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        .status-online {
            background-color: #28a745;
        }
        .status-offline {
            background-color: #dc3545;
        }
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        .form-section {
            margin-bottom: 2rem;
        }
        .section-title {
            color: white;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }
        .section-title i {
            margin-right: 10px;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <!-- æ ‡é¢˜ -->
                <div class="text-center mb-4">
                    <h1 class="text-white mb-3">
                        <i class="bi bi-play-circle"></i>
                        å“”å“©å“”å“©MCPå®¢æˆ·ç«¯æ§åˆ¶å°
                    </h1>
                    <p class="text-white-50">ç®¡ç†å’Œæµ‹è¯•MCPå®¢æˆ·ç«¯çš„æ‰€æœ‰åŠŸèƒ½</p>
                    
                    <!-- æ¨¡å¼åˆ‡æ¢ -->
                    <div class="mt-3">
                        <a href="ai-chat.html" class="btn btn-primary me-2">
                            <i class="bi bi-robot"></i> AIæ™ºèƒ½åŠ©æ‰‹
                        </a>
                        <span class="text-white-50">æˆ–ä½¿ç”¨ä¸‹æ–¹çš„</span>
                        <span class="text-white">æ‰‹åŠ¨æ§åˆ¶é¢æ¿</span>
                    </div>
                </div>

                <!-- çŠ¶æ€ç›‘æ§ -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="bi bi-activity"></i>
                        ç³»ç»ŸçŠ¶æ€
                    </h3>
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <button class="btn btn-primary w-100" onclick="checkConnectionStatus()">
                                        <i class="bi bi-wifi"></i> è¿æ¥çŠ¶æ€
                                    </button>
                                </div>
                                <div class="col-md-4">
                                    <button class="btn btn-primary w-100" onclick="getAvailableTools()">
                                        <i class="bi bi-tools"></i> å¯ç”¨å·¥å…·
                                    </button>
                                </div>
                                <div class="col-md-4">
                                    <button class="btn btn-primary w-100" onclick="getServerStatus()">
                                        <i class="bi bi-server"></i> æœåŠ¡å™¨çŠ¶æ€
                                    </button>
                                </div>
                            </div>
                            <div id="statusResult" class="result-box d-none"></div>
                        </div>
                    </div>
                </div>

                <!-- ç™»å½•è®¾ç½® -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="bi bi-person-check"></i>
                        ç™»å½•è®¾ç½®
                    </h3>
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-9">
                                    <input type="password" class="form-control" id="sessdataInput" 
                                           placeholder="è¯·è¾“å…¥å“”å“©å“”å“©çš„SESSDATA Cookieå€¼">
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-primary w-100" onclick="setSessdata()">
                                        <i class="bi bi-key"></i> è®¾ç½®ç™»å½•
                                    </button>
                                </div>
                            </div>
                            <small class="text-muted">
                                ğŸ’¡ SESSDATAå¯åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„Application â†’ Cookiesä¸­æ‰¾åˆ°
                            </small>
                            <div id="sessdataResult" class="result-box d-none"></div>
                        </div>
                    </div>
                </div>

                <!-- è§†é¢‘æœç´¢ -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="bi bi-search"></i>
                        è§†é¢‘æœç´¢
                    </h3>
                    <div class="card">
                        <div class="card-body">
                            <!-- åŸºç¡€æœç´¢ -->
                            <h6 class="mb-3">åŸºç¡€æœç´¢</h6>
                            <div class="row mb-3">
                                <div class="col-md-9">
                                    <input type="text" class="form-control" id="searchKeyword" 
                                           placeholder="è¾“å…¥æœç´¢å…³é”®è¯ï¼Œå¦‚ï¼šç¨‹åºå‘˜ã€ç¼–ç¨‹æ•™ç¨‹">
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-primary w-100" onclick="searchVideos()">
                                        <i class="bi bi-search"></i> æœç´¢è§†é¢‘
                                    </button>
                                </div>
                            </div>

                            <!-- é«˜çº§æœç´¢ -->
                            <h6 class="mb-3">é«˜çº§æœç´¢</h6>
                            <div class="row">
                                <div class="col-md-4">
                                    <input type="text" class="form-control" id="advancedKeyword" 
                                           placeholder="æœç´¢å…³é”®è¯">
                                </div>
                                <div class="col-md-2">
                                    <input type="number" class="form-control" id="searchPage" 
                                           value="1" min="1" placeholder="é¡µç ">
                                </div>
                                <div class="col-md-3">
                                    <select class="form-select" id="searchOrder">
                                        <option value="totalrank">ç»¼åˆæ’åº</option>
                                        <option value="click">æ’­æ”¾é‡</option>
                                        <option value="pubdate">å‘å¸ƒæ—¶é—´</option>
                                        <option value="dm">å¼¹å¹•æ•°</option>
                                        <option value="stow">æ”¶è—æ•°</option>
                                        <option value="scores">è¯„åˆ†</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <select class="form-select" id="searchDuration">
                                        <option value="0">å…¨éƒ¨æ—¶é•¿</option>
                                        <option value="1">10åˆ†é’Ÿä»¥ä¸‹</option>
                                        <option value="2">10-30åˆ†é’Ÿ</option>
                                        <option value="3">30-60åˆ†é’Ÿ</option>
                                        <option value="4">60åˆ†é’Ÿä»¥ä¸Š</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-12">
                                    <button class="btn btn-primary" onclick="searchVideosFromWeb()">
                                        <i class="bi bi-search-heart"></i> é«˜çº§æœç´¢
                                    </button>
                                </div>
                            </div>
                            <div id="searchResult" class="result-box d-none"></div>
                        </div>
                    </div>
                </div>

                <!-- è§†é¢‘ä¸‹è½½ -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="bi bi-download"></i>
                        è§†é¢‘ä¸‹è½½
                    </h3>
                    <div class="card">
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-9">
                                    <input type="text" class="form-control" id="videoInput" 
                                           placeholder="è¾“å…¥è§†é¢‘é“¾æ¥æˆ–BVå·ï¼Œå¦‚ï¼šBV1234567890">
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-primary w-100" onclick="createDownloadTask()">
                                        <i class="bi bi-download"></i> åˆ›å»ºä¸‹è½½
                                    </button>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-9">
                                    <input type="text" class="form-control" id="taskIdInput" 
                                           placeholder="è¾“å…¥ä»»åŠ¡IDæŸ¥è¯¢ä¸‹è½½çŠ¶æ€">
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-primary w-100" onclick="getDownloadStatus()">
                                        <i class="bi bi-clock-history"></i> æŸ¥è¯¢çŠ¶æ€
                                    </button>
                                </div>
                            </div>
                            <div id="downloadResult" class="result-box d-none"></div>
                        </div>
                    </div>
                </div>

                <!-- åº•éƒ¨ä¿¡æ¯ -->
                <div class="text-center mt-4">
                    <p class="text-white-50 mb-0">
                        <i class="bi bi-info-circle"></i>
                        å“”å“©å“”å“©MCPå®¢æˆ·ç«¯ v1.0.0 | åŸºäºSpring AI MCPåè®®
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = '/api/bilibili';
        
        // é€šç”¨è¯·æ±‚å‡½æ•°
        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(url, {
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        ...options.headers
                    },
                    ...options
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return await response.text();
            } catch (error) {
                return `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`;
            }
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(elementId, result) {
            const element = document.getElementById(elementId);
            element.textContent = result;
            element.classList.remove('d-none');
            
            // è‡ªåŠ¨æ»šåŠ¨åˆ°ç»“æœ
            element.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        // æ£€æŸ¥è¿æ¥çŠ¶æ€
        async function checkConnectionStatus() {
            const result = await makeRequest(`${API_BASE}/status`);
            showResult('statusResult', result);
        }
        
        // è·å–å¯ç”¨å·¥å…·
        async function getAvailableTools() {
            const result = await makeRequest(`${API_BASE}/tools`);
            showResult('statusResult', result);
        }
        
        // è·å–æœåŠ¡å™¨çŠ¶æ€
        async function getServerStatus() {
            const result = await makeRequest(`${API_BASE}/server-status`);
            showResult('statusResult', result);
        }
        
        // è®¾ç½®SESSDATA
        async function setSessdata() {
            const sessdata = document.getElementById('sessdataInput').value.trim();
            if (!sessdata) {
                showResult('sessdataResult', 'âŒ è¯·è¾“å…¥SESSDATA');
                return;
            }
            
            const formData = new URLSearchParams();
            formData.append('sessdata', sessdata);
            
            const result = await makeRequest(`${API_BASE}/sessdata`, {
                method: 'POST',
                body: formData
            });
            
            showResult('sessdataResult', result);
        }
        
        // åŸºç¡€æœç´¢
        async function searchVideos() {
            const keyword = document.getElementById('searchKeyword').value.trim();
            if (!keyword) {
                showResult('searchResult', 'âŒ è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }
            
            const url = `${API_BASE}/search?keyword=${encodeURIComponent(keyword)}`;
            const result = await makeRequest(url);
            showResult('searchResult', result);
        }
        
        // é«˜çº§æœç´¢
        async function searchVideosFromWeb() {
            const keyword = document.getElementById('advancedKeyword').value.trim();
            if (!keyword) {
                showResult('searchResult', 'âŒ è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }
            
            const page = document.getElementById('searchPage').value;
            const order = document.getElementById('searchOrder').value;
            const duration = document.getElementById('searchDuration').value;
            
            const url = `${API_BASE}/search-web?keyword=${encodeURIComponent(keyword)}&page=${page}&order=${order}&duration=${duration}`;
            const result = await makeRequest(url);
            showResult('searchResult', result);
        }
        
        // åˆ›å»ºä¸‹è½½ä»»åŠ¡
        async function createDownloadTask() {
            const videoInput = document.getElementById('videoInput').value.trim();
            if (!videoInput) {
                showResult('downloadResult', 'âŒ è¯·è¾“å…¥è§†é¢‘é“¾æ¥æˆ–BVå·');
                return;
            }
            
            const formData = new URLSearchParams();
            formData.append('videoUrlOrBvid', videoInput);
            
            const result = await makeRequest(`${API_BASE}/download`, {
                method: 'POST',
                body: formData
            });
            
            showResult('downloadResult', result);
        }
        
        // æŸ¥è¯¢ä¸‹è½½çŠ¶æ€
        async function getDownloadStatus() {
            const taskId = document.getElementById('taskIdInput').value.trim();
            if (!taskId) {
                showResult('downloadResult', 'âŒ è¯·è¾“å…¥ä»»åŠ¡ID');
                return;
            }
            
            const result = await makeRequest(`${API_BASE}/download/${encodeURIComponent(taskId)}`);
            showResult('downloadResult', result);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥è¿æ¥çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            checkConnectionStatus();
        });
        
        // å›è½¦é”®å¿«æ·æ“ä½œ
        document.getElementById('searchKeyword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') searchVideos();
        });
        
        document.getElementById('advancedKeyword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') searchVideosFromWeb();
        });
        
        document.getElementById('videoInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') createDownloadTask();
        });
        
        document.getElementById('taskIdInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') getDownloadStatus();
        });
        
        document.getElementById('sessdataInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') setSessdata();
        });
    </script>
</body>
</html> 